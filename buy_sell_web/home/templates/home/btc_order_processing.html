{% load static %}
{% load widget_tweaks %}
{% load crispy_forms_tags %}
{% load humanize %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>{{ user.first_name }} {{ user.last_name }}'s Dashboard</title>


    <link rel="stylesheet" href="{% static 'home/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.css' %}">

    <link rel="stylesheet" href="{% static 'home/css/style_dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/style3.css' %}">

    <link rel="stylesheet" href="{% static 'home/css/jquery.mCustomScrollbar.min.css' %}">


    <script defer src="{% static 'home/js/solid.js' %}"></script>
    <script defer src="{% static 'home/js/fontawesome.js' %}"></script>


</head>
<body>
    <div class="wrapper">
        <!-- Page Content  -->
        <div id="contain" style = "background-color: #f3f5f9; color: #717171;">
            <main role="main" style="min-height: 100vh;">
                    <div class = "money_ex_form" style = "background-color: #ffffff; border-radius: 10px">

                         <form method="post" novalidate>
                              {% csrf_token %}


                             <div class="form-group" style="text-align:center">
                                 <a style="font-size: 20px; color:#000">Order ID: {{ order.belonging_order_id }}</a>
                                 <br>
                                 <a style="font-size: 17px; color:#000">
                                    Process order
                                 </a>
                             </div>
                             <div class="row">
                                <div class="col-md">
                                    <ul style="list-style-type:none; margin: 0; padding: 0;">
                                        <li>
                                            <div style="float:left">
                                              <div style="text-align:left; float: right; margin-left: 20px;">
                                                  <div>
                                                      <a class="history_a1" style="font-weight: 600; color: black;">Send</a>
                                                  </div>
                                              </div>
                                            </div>
                                            <div style="float:right;">
                                              <div style="text-align:right; float: left; margin-right: 20px;">
                                                  <div>
                                                      <a class="history_a1" style="font-weight: 600; color: black;">Receive</a>
                                                  </div>
                                              </div>
                                            </div>
                                      </li>
                                    </ul>
                                </div>
                             </div>
                             <hr>
                             <div class="form-row">
                                 <div class="col-md">
                                        <ul style="list-style-type:none; margin: 0; padding: 0;">
                                            <li>
                                                <div style="float:left">
                                                  <div style="float: left;">
                                                      <img class="history_im1" style="background-color: #fff; margin-top: 8px;" src="{% get_static_prefix %}home/images/{{order.sent_from}}_round.png">
                                                  </div>
                                                  <div style="text-align:left; float: right; margin-left: 20px;">
                                                      <div>
                                                          <a id="from_select" class="history_a2" style="font-weight: 600; color: black;">{{ order.sent_from }}</a>
                                                      </div>
                                                      <div>
                                                          <a class="history_a1" style="font-weight: 600; color: black;">{{ order.sent_amount }} {{ order.send_unit }}</a>
                                                      </div>
                                                  </div>
                                                </div>
                                                <div style="float:right;">
                                                  <div style="float: right;">
                                                      <img class="history_im1" style="background-color: #fff; margin-top: 8px;" src="{% get_static_prefix %}home/images/{{order.receive_at}}_round.png">
                                                  </div>
                                                  <div style="text-align:right; float: left; margin-right: 20px;">
                                                      <div>
                                                          <a id="to_select" class="history_a2" style="font-weight: 600; color: black;">{{ order.receive_at }}</a>
                                                      </div>
                                                      <div>
                                                          <a class="history_a1" style="font-weight: 600; color: black;">{{ order.to_be_sent }} {{ order.rcv_unit }}</a>
                                                      </div>
                                                  </div>
                                                </div>
                                          </li>
                                        </ul>
                                 </div>
                             </div>
                             <hr>
                             <div class="form-row">
                                 <div class="col-md">
                                        <ul style="list-style-type:none; margin: 0; padding: 0;">
                                            <li>
                                                <div style="float:left">
                                                  <div style="text-align:left; float: right;">
                                                      <div>
                                                          <a class="history_a1" style="font-weight: 600; color: black;">
                                                              Sender:
                                                          </a>
                                                      </div>
                                                      <div>
                                                          <a id="sent_account" class="history_a2" style="font-weight: 600; color: black;">
                                                              {{ order.send_acount }}
                                                          </a>
                                                      </div>
                                                  </div>
                                                </div>
                                                <div style="float:right;">
                                                  <div style="text-align:right; float: left;">
                                                      <div>
                                                          <a class="history_a1" style="font-weight: 600; color: black;">
                                                              Receiver:
                                                          </a>
                                                      </div>
                                                      <div>
                                                          <a id="receive_account" class="history_a2" style="font-weight: 600; color: black;">
                                                                {{ order.rcv_acount }}
                                                          </a>
                                                      </div>
                                                  </div>
                                                </div>
                                          </li>
                                        </ul>
                                 </div>
                             </div>
                             <hr>
                             <div class="form-row">
                                 <div class="col-md">
                                        <ul style="list-style-type:none; margin: 0; padding: 0;">
                                            <li>
                                                <div style="float:left">
                                                  <div style="text-align:left; float: right;">
                                                      <div>
                                                          <a class="history_a1" style="font-weight: 600; color: black;">
                                                              Transaction Id:
                                                          </a>
                                                      </div>
                                                      <div>
                                                          <a id="sent_account" class="history_a2" style="font-weight: 600; color: black;">
                                                              {{ order.trx_id }}
                                                          </a>
                                                      </div>
                                                  </div>
                                                </div>
                                                <div style="float:right;">
                                                  <div style="text-align:right; float: left;">
                                                      <div>
                                                          <a class="history_a1" style="font-weight: 600; color: black;">
                                                              Admin Received at:
                                                          </a>
                                                      </div>
                                                      <div>
                                                          <a id="receive_account" class="history_a2" style="font-weight: 600; color: black;">
                                                                {{ order.admin_receiving_account }}
                                                          </a>
                                                      </div>
                                                  </div>
                                                </div>
                                          </li>
                                        </ul>
                                 </div>
                             </div>
                             <hr>
                             <div class="form-group" style="text-align: center;">
                                 <a style="color: #000; font-size: 12px">What should be the order status??</a>
                             </div>
                             <div class="form-row">
                                 <div class="form-col col-md classWithPad">
                                     <div style="text-align:center;">
                                          <a class="history_a1" style="font-weight: 600; color: black;">
                                              Admin Received:
                                          </a>
                                     </div>
                                     <div class="form-group" style="text-align:center; padding: 10px;">
                                         {% render_field form.admin_received value=order.sent_amount id="number1" class="form-control" oninput="refreshOrderForm1();" %}
                                         <a class="history_a2" style="font-weight: 600; color: black;">
                                             {{ order.send_unit }}
                                         </a>
                                     </div>
                                 </div>
                                 <div class="form-col col-md classWithPad">
                                     <div style="text-align:center;">
                                          <a class="history_a1" style="font-weight: 600; color: black;">
                                              Admin sends:
                                          </a>
                                     </div>
                                     <div class="form-group" style="text-align:center; padding: 10px;">
                                         {% render_field form.admin_sends value=order.to_be_sent id="number2" class="form-control" %}
                                         <a class="history_a2" style="font-weight: 600; color: black;">
                                             {{ order.rcv_unit }}
                                         </a>
                                     </div>
                                 </div>
                             </div>
                             <div class="form-group classWithPad" style="text-align:center;">
                                 <a class="history_a2" style="font-weight: 600; color: black;">
                                     From Which account admin will send?
                                 </a>

                                 <select class="form-control" id="admin_sending_acc" onchange="changeAccount();">
                                     {% for account in admin_sending_accounts %}
                                        <option value="{{ account.address }}">{{ account.address }}</option>
                                     {% endfor %}
                                </select>
                             </div>
                             <div class="form-group classWithPad">
                                 {% render_field form.admin_sending_acc id="admin_sending_acc2" class="form-control" %}
                             </div>
                             {% if order.receive_at == 'btcusd' %}
                                 <div class="form-group classWithPad">
                                     <a class="history_a2" style="font-weight: 600; color: black;">
                                         wallet Address
                                     </a>
                                 </div>
                                 <div class="form-group classWithPad">
                                         {% render_field form1.wallet class="form-control" %}
                                 </div>
                             {% endif %}
                             <div class="form-group classWithPad">
                                 <a class="history_a2" style="font-weight: 600; color: black;">
                                     Admin Transaction ID
                                 </a>
                             </div>
                             <div class="form-group classWithPad">
                                 {% render_field form.admin_transaction_id class="form-control" %}
                             </div>
                             <div class="form-group classWithPad">
                                 {% render_field form.status class="form-control" %}
                             </div>

                               <div class="form-group classWithPad" style="align: center">
                                <button class="form-control" type="submit">save</button>

                               </div>

                            </form>
                    </div>
            </main>
            <nav class="navbar navbar-expand-lg" style="background-color: #7386D5">
                <div class="container-fluid">

                    <!-- <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn" >
                        <i class="fas fa-align-left"></i>
                        <span>Toggle Sidebar</span>
                    </button> -->
                    <a class="navbar-brand mr-4" href="{% url 'amra_nashokota_korbo' %}">ExonTime Admin Panel</a>
                    <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <i class="fas fa-align-justify"></i>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-item nav-link" href="{% url 'home' %}">Visit Site</a>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <footer style="background-color:#373737;" id="footer" class="foot">
                <div class="container" style="text-align: center; padding-top: 15px;">
                    <p style="color:#FFFFFF" ><strong>Copyright &copy; 2020 ExonTime </strong></p>
                </div>
            </footer>
         </div>
    </div>




    <!-- jQuery CDN - Slim version (=without AJAX) -->

    <script src="{% static 'home/js/jquery-3.4.1.min.js' %}"></script>
    <!-- Popper.JS -->
    <script src="{% static 'home/js/popper.min.js' %}"></script>
    <!-- Bootstrap JS -->
    <script src="{% static 'home/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'home/js/bootstrap.js' %}"></script>

    <script src="{% static 'home/js/jquery.bootstrap.modal.forms.js' %}"></script>
    <!-- You can alternatively load the minified version -->
    <script src="{% static 'home/js/jquery.bootstrap.modal.forms.min.js' %}"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="{% static 'home/js/jquery.mCustomScrollbar.concat.min.js' %}"></script>


    <script type="text/javascript">
    var refreshOrderForm1 = function(){
        $.ajax({
            url: "{% url 'get_info_update' %}",
            method: 'GET',
            dataType : "json",
            data: {},
            success: function(response){
              var val = parseFloat(document.getElementById("number1").value);
              madeSelectionfrom = document.getElementById("from_select").innerHTML;
              madeSelectionto = document.getElementById("to_select").innerHTML;
              var ans = 0;
              var res = 0.0;
              var max = 0.0;
              var rt = 0.0;
              for(var i = 0; i < response["reserves"].length; i++)
              {
                  var product = response["reserves"][i];
                  if(product["title"] == madeSelectionfrom){
                      var rate = parseFloat(product[madeSelectionto]);
                      rt = rate;
                      max = product["maxim"];
                      if(val == 0){ ans = 0; }
                      else{ ans = val*rate; }
                  }
              }
              ans = ans.toFixed(2);
              document.getElementById("number2").value = ans;
            },
            error: function(error){
                console.log(error);
                console.log("error");
            }
        });
    }

  </script>
    <script type="text/javascript">
        var changeAccount = function(){
            accnt = document.getElementById("admin_sending_acc").value;
            document.getElementById("admin_sending_acc2").value = accnt;
        }
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            changeAccount();
            $("#sidebar").mCustomScrollbar({
                theme: "minimal"
            });
            $('#sidebarCollapse').on('click', function () {
                $('#content, .foot, .foot2').toggleClass('active');
                $('.collapse.in').toggleClass('in');
                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            });
        });

    </script>





  <script type="text/javascript">

      function DropDown(el) {
          this.dd = el;
          this.placeholder = this.dd.children('span');
          this.opts = this.dd.find('ul.dropdown > li');
          this.val = '';
          this.index = -1;
          this.initEvents();
      }
      DropDown.prototype = {
          initEvents : function() {
              var obj = this;

              obj.dd.on('click', function(event){
                  $(this).toggleClass('active');
                  return false;
              });

              obj.opts.on('click',function(){
                  var opt = $(this);
                  obj.val = opt.text();
                  obj.index = opt.index();
                  obj.placeholder.text(obj.val);
                  document.getElementById("in1").value = obj.val;
              });
          },
          getValue : function() {
              return this.val;
          },
          getIndex : function() {
              return this.index;
          }
      }

      $(function() {

          var dd = new DropDown( $('#dd') );

          $(document).click(function() {
              // all dropdowns
              $('.wrapper-dropdown-3').removeClass('active');
          });

      });

  </script>
<script type="text/javascript">
        function idleTimer() {
            var t;
            window.onload = resetTimer;
            //window.onmousemove = resetTimer;
            //window.onmousedown = resetTimer;
            window.onclick = resetTimer;
            window.onscroll = resetTimer;
            window.onkeypress = resetTimer;

            function logout() {
                window.location.href = "{% url 'logout' %}";
            }

           function reload() {
                  window.location = self.location.href;
           }

           function resetTimer() {
                clearTimeout(t);
                t = setTimeout(logout, 1800000);
                //t= setTimeout(reload, 300000);
            }
        }
        {% if user.is_authenticated %}
        idleTimer();
        {% endif %}
    </script>
</body>

</html>
